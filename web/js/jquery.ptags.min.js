/*
 * jQuery Pines Tags (ptags) Plugin 1.0.0
 *
 * Copyright (c) 2009-2010 Hunter Perrin
 *
 * Licensed (along with all of Pines) under the GNU Affero GPL:
 *	  http://www.gnu.org/licenses/agpl.html
 */
(function(b){b.fn.ptags_add=function(e){if(!e)return this;this.each(function(){this.pines_tags&&this.pines_tags.ptags_add(e)});return this};b.fn.ptags_remove=function(e){if(!e)return this;this.each(function(){this.pines_tags&&this.pines_tags.ptags_remove(e)});return this};b.fn.ptags_remove_all=function(){this.each(function(){this.pines_tags&&this.pines_tags.ptags_remove_all()});return this};b.fn.ptags=function(e){var h=b.extend({},b.fn.ptags.defaults,e);e=this;e.each(function(){var a=b(this);a.ptags_version=
"1.0.0";if(a.hasClass("ui-ptags-tag-box"))return true;a.addClass("ui-ptags-tag-box");a.extend(a,h);a.ptags_widget=b("<div />");a.ptags_container=b("<div />");a.ptags_tags=a.ptags_tags.slice();a.ptags_add=function(c){b.merge(a.ptags_tags,typeof c=="string"?[c]:c);a.ptags_unique_check();a.ptags_update_val();a.ptags_update_tags()};a.ptags_remove=function(c){b.each(typeof c=="string"?[c]:c,function(){var g=b.inArray(""+this,a.ptags_tags);g>-1&&a.ptags_tags.splice(g,1)});a.ptags_update_val();a.ptags_update_tags()};
a.ptags_remove_all=function(){a.ptags_tags=[];a.ptags_update_val();a.ptags_update_tags()};a.ptags_unique_check=function(){for(var c=0;c<a.ptags_tags.length;c++)if(b.inArray(a.ptags_tags[c],a.ptags_tags)<c||a.ptags_tags[c]==""){a.ptags_tags.splice(c,1);c--}};a.ptags_update_val=function(){a.val(a.ptags_tags.join(a.ptags_delimiter))};a.ptags_update_tags=function(){if(a.ptags_show_tags){a.ptags_tag_container.empty();b.each(a.ptags_tags,function(c,g){var f=b("<div />").addClass("ui-state-default ui-corner-all ui-ptags-tag");
f.append(b("<div />").addClass("ui-ptags-tag-text").html(g).click(function(){if(a.ptags_editable&&a.ptags_input_box){d.val(f.text()).focus().select();a.ptags_remove(f.text())}}));a.ptags_editable&&a.ptags_input_box&&f.hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});a.ptags_remover&&f.append(b("<span />").addClass("ui-ptags-tag-remover ui-icon ui-icon-circle-minus").click(function(){a.ptags_remove(f.text())}));a.ptags_tag_container.append(f)})}};
a.ptags_widget.addClass("ui-ptags ui-helper-clearfix");a.wrapAll(a.ptags_widget);a.ptags_widget=a.parent();a.ptags_container.addClass("ui-ptags-tag-box-container");a.wrapAll(a.ptags_container);a.ptags_container=a.parent();if(a.ptags_input_box){var d=b(a.get(0)).clone().val("").keydown(function(c){if(c.keyCode==13&&!c.shiftKey){a.ptags_add(d.val().split(a.ptags_delimiter));d.val("");return false}}).blur(function(){if(d.val()!=""){a.ptags_add(d.val().split(a.ptags_delimiter));d.val("")}});d.attr("id")&&
d.attr("id",d.attr("id")+"__ptags");d.attr("name")&&d.attr("name",d.attr("name")+"__ptags");a.ptags_container.append(d)}if(a.ptags_current_text){var i=a.val().split(a.ptags_delimiter);b.merge(a.ptags_tags,i);a.ptags_unique_check();a.ptags_update_val()}a.ptags_show_box?a.blur(function(){var c=a.val().split(a.ptags_delimiter);b.merge(a.ptags_tags,c);a.ptags_unique_check();a.ptags_update_val();a.ptags_update_tags()}):a.css("display","none");if(a.ptags_show_tags){a.ptags_tag_container=b("<div />").addClass("ui-ptags-tag-container");
a.ptags_widget.append(a.ptags_tag_container);a.ptags_update_tags()}a.ptags_widget.append(b("<br />").addClass("ui-helper-clearfix ui-ptags-clear"));this.pines_tags=a});return e};b.fn.ptags.defaults={ptags_tags:[],ptags_current_text:true,ptags_delimiter:",",ptags_show_tags:true,ptags_show_box:false,ptags_input_box:true,ptags_remover:true,ptags_editable:true}})(jQuery);
