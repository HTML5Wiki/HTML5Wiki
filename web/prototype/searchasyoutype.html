<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="utf-8" />
	<title>Aritkel | HTML5Wiki</title>
	<meta name="description" content="">
 	<meta name="author" content="HTML5Wiki">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
	<link rel="icon" href="favicon.ico" type="image/ico" />
	<link rel="stylesheet" href="css/main.css" /> 
	<!--script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js?ver=1.4.2"></script--> 
	<script type="text/javascript" src="js/jquery-nonproductive.js"></script>

</head> 
<body>
	<header class="header-overall">
		<a href="#" class="logo"><span class="hide">HTML5Wiki</span></a>
		<nav class="main-menu">
			<ol class="menu-items clearfix">
				<li class="item home"><a href="#" class="tab active">Startseite</a></li>
				<li class="item updates"><a href="#" class="tab">Neuste Änderungen</a></li>
				<li class="item search">
					<input placeholder="Suchen" id="header-searchbox" class="searchterm" accesskey="s" />
					<div id="header-searchbox-results" class="searchbox-results" />
				</li>
			</ol>
		</nav>
	</header>
		
	<article class="content article">
		<header class="title clearfix">
			<h1 class="heading">SearchAsYouType Prototype</h1>
			<ol class="capsulebar">
				<li class="item first active read"><a href="#" class="capsule"><span class="caption">Lesen</span></a></li>
				<li class="item edit"><a href="#" class="capsule"><span class="caption">Bearbeiten</span></a></li>
				<li class="item last history"><a href="#" class="capsule"><span class="caption">&Auml;nderungsgeschichte</span></a></li>
			</ol>
		</header>
		
		
		<section>
			<p>
				Use the search field :) Examplewords begin with 'a' or 'b'
			</p>
		</section>
	</article>
	
	<script type="text/javascript">
		
		/**
		 * Controller for a Searchbox-Field
		 *
		 * @author Manuel Alabor
		 */
		var SearchBoxController = (function() {
			var self = {},
				selectedResultItem = 0;
			
			/**
			 * Initializes the Event-Handling for a Searchbox
			 * (Text-Inputfield)
			 *
			 * @param searchBox jQuery-DOM-Object
			 */
			self.initWithSearchBox = function(searchBox) {
				$(searchBox).keyup(handleKeyUp);
			};
			
			/**
			 * Handles KeyEvents for the keyUp-Event.
			 *
			 * @param event
			 * @scope private
			 */
			function handleKeyUp(event) {
				var keycode = event.which;
				var term = $(this).val();
				var resultContainer = $('#header-searchbox-results');

				if(keycodeTriggersSearch(keycode)) {
					///////////////////////////////////////
					// Following line has to be replaced with an ajax request
					var results = search(term);
					///////////////////////////////////////

					var resultList = $('<ol/>');
					for(var i = 0, l = results.length; i < l; i++) {
						resultList.append(createResultItem(results[i]));
					}
					resultContainer.empty();
					resultContainer.append(resultList);
					
					selectedResultItem = 0;
					
				} else {
					var updateSelectedItem = false;

					switch(keycode) {
						case 40 : // Down
							var totalItems = $('.result-item').length;
							if(selectedResultItem < totalItems){
								selectedResultItem++;
								updateSelectedItem = true;
							}
						break;
						case 38 : // Up
						 	if(selectedResultItem > 1) {
								selectedResultItem--;
								updateSelectedItem = true;
							}
						break;
					}

					if(updateSelectedItem) {
						var selectorString = '.result-item:nth-child('+selectedResultItem+')';
						$('.result-item.selected').removeClass('selected');
						$(selectorString).addClass('selected');
						event.preventDefault();
					}
				}
			};
			
			/**
			 * Returns the currently selected Resultitem inside the
			 * Resultlist
			 *
			 * @returns Index
			 */
			self.getSelectedResultItem = function() {
				return self.selectedResultItem;
			};
			
			/**
			 * Ensures that keys like CTRL or SHIFT don't trigger a search request.
			 *
			 * @param keycode
			 * @returns true/false
			 * @scope private
			 */
			function keycodeTriggersSearch(keycode) {
				return (keycode >= 48
						|| keycode == 46
						|| keycode == 8
						|| keycode == 32
						|| keycode == 0);
			}
			
			/**
			 * Creates a resultitem with a resulttext
			 *
			 * @see SearchBoxController#handleKeyUp
			 * @returns DOM-Objekt
			 * @scope private
			 */
			createResultItem = function(resultText) {
				return $('<li class="result-item">'+resultText+'</li>')
			}
			
			
			return self;
		}());  // end SearchBoxController
	
	
	
	
	
	
	
	
	
	
	
		SearchBoxController.initWithSearchBox($('#header-searchbox'));
		
		/**
		 * Simulates an AJAX-Searchrequest and returns matching resultitems.
		 * It's caseinsensitive.
		 *
		 * @param term Term
		 * @returns Array with matching items
		 */
		function search(term) {
			var objectsToSearchIn = [
				'Aargau, Kanton und Weinregion / Schweiz'
				,'Abaca'
				,'Abadesa' 	 
				,'Abbaukrankheit' 	 
				,'Abbeeren' 	 
				,'Abbondosa'
				,'Abbuoto'
				,'ABC Trinker'
				,'Abfindungsbrennerei'
				,'Abfüllen' 	 
				,'Abfüllschock' 	 
				,'Abfüllung und Reife (Wein)'
				,'Abgang' 	 
				,'abgebaut' 	 
				,'abgerundet' 	 
				,'abkühlen' 	 
				,'Ablagerung' 	 
				,'Ableger'	 
				,'aboccato'
				,'Biowein' 	 
				,'Birk, Heinrich (1898-1973)' 	 
				,'Birne - Geschmacksvielfalt beim Wein' 	 
				,'Birstaler Muskat'
				,'Bischoff, Oskar (1912-1985)' 	 
				,'Bissig (Wein)' 	 
				,'Bitartrat-Kristalle' 	 
				,'Bitter'
				,'Bittermandel' 	 
				,'Biturica' 	 
				,'Bivongi' 	 
				,'Black Eagle'
			];
			var results = Array();
			term = term.trim();
			
			if(term != '') {
				term = term.toUpperCase();
				
				for(var i = 0, l = objectsToSearchIn.length; i < l; i++) {
					var toMatch = objectsToSearchIn[i].toUpperCase();
					var result = objectsToSearchIn[i];
					
					if(term.length <= toMatch.length) {
						if(toMatch.substring(0,term.length) == term) {
							result = '<span class="typed">'
								   + result.substring(0,term.length)
								   + '</span>'
								   + result.substring(term.length);
							results.push(result);
						}
					}				
				}
			}
			
			return results;
		}
		
	</script>
	
</body>
</html>