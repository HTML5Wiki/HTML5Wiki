<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="utf-8" />
	<title>Aritkel | HTML5Wiki</title>
	<meta name="description" content="">
 	<meta name="author" content="HTML5Wiki">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon" />
	<link rel="icon" href="../images/favicon.ico" type="image/ico" />
	<link rel="stylesheet" href="../css/html5wiki.css" />
	<!--script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js?ver=1.4.2"></script--> 
	<script type="text/javascript" src="js/jquery-nonproductive.js"></script>
</head> 
<body>
	<header class="header-overall">
		<a href="#" class="logo"><span class="hide">HTML5Wiki</span></a>
		<nav class="main-menu">
			<ol class="menu-items clearfix">
				<li class="item home active"><a href="#" class="tab">Startseite</a></li>
				<li class="item updates"><a href="#" class="tab">Neuste Änderungen</a></li>
				<li class="item search">
					<input placeholder="Suchen" id="header-searchbox" class="searchterm" accesskey="s" />
				</li>
			</ol>
		</nav>
	</header>
		
	<article class="content article">
		<header class="title clearfix">
			<h1 class="heading">SearchAsYouType Prototype</h1>
			<ol class="capsulebar">
				<li class="item first active read"><a href="#" class="capsule"><span class="caption">Lesen</span></a></li>
				<li class="item edit"><a href="#" class="capsule"><span class="caption">Bearbeiten</span></a></li>
				<li class="item last history"><a href="#" class="capsule"><span class="caption">&Auml;nderungsgeschichte</span></a></li>
			</ol>
		</header>
		
		
		<section>
			<p>
				Use the search field :) Examplewords begin with 'a' or 'b'
			</p>
		</section>
	</article>
	
	<script type="text/javascript">
		
		/**
		 * Controller for a Searchbox-Field.<br/>
		 * To use, wrap an input-element (suggest to use one with the type "text")
		 * into a parent DOM element. Afterwards call SearchBoxController#initWithSearchBox
		 * and pass the JQuery representation of the input element as argument.<br/>
		 * SearchBoxController will then create all necessary event bindings and creates a
		 * DOM-object for keeping the result list in the searchbox' parent.
		 *
		 * @author Manuel Alabor
		 * @see SearchBoxController#initWithSearchBox
		 */
		var SearchBoxController = (function() {
			var self = {}
				,selectedResultItem = -1
				,totalResultItems = 0
				,resultItems = ''
				,resultContainer = '';
			
			/**
			 * Initializes the Event-Handling for a Searchbox
			 * (Text-Inputfield)
			 *
			 * @param searchBox jQuery-DOM-Object
			 * @access public
			 */
			self.initWithSearchBox = function(searchBox) {
				/* Eventbindings: */
				// Bind search-functionalities:
				$(searchBox).bind('keyup',handleKeyUp);
				$(searchBox).bind('keydown',handleKeyDown);
				
				// Bind functionalities to hide resultlist on focus-lose:
				$('body').bind('click',handleBodyClick);
				
				
				/* Resultcontainer: */
				// This container is created in the parent of the searchbox.
				// It will contain an ordered list with matched searchresults
				// later on.
				resultContainer = $('<div id="header-searchbox-results" class="searchbox-results" />');
				resultContainer.hide();
				$(searchBox).parent().append(resultContainer);
			};
			
			/**
			 * Returns the currently selected Resultitem inside the
			 * Resultlist
			 *
			 * @returns Index
			 * @access public
			 */
			self.getSelectedResultItem = function() {
				return self.selectedResultItem;
			};
			
			/**
			 * Selects a specific item in the current resultlist according
			 * to its index.
			 *
			 * @param Index
			 * @access public
			 */
			self.setSelectedResultItem = function(index) {
				if(selectedResultItem != index) {
					$('.result-item.selected',resultContainer).removeClass('selected');
					if(index > -1) $($('.result-item',resultContainer)[index]).addClass('selected');
					selectedResultItem = index;
				}
			};
			
			/**
			 * Selects, if possible, the next result item in the result list.
			 *
			 * @returns true if selection was possible, false if not
			 * @access public
			 */
			self.selectNextResultItem = function() {
				var wasAbleToSelect = false;
				var newIndex = selectedResultItem+1;
				
				if(newIndex < totalResultItems) {
					self.setSelectedResultItem(newIndex);
					wasAbleToSelect = true;
				}
				
				return wasAbleToSelect;
			};
			
			/**
			 * Selects, if possible, the previous result item in the result list.
			 *
			 * @returns true if selection was possible, false if not
			 * @access public
			 */
			self.selectPreviousResultItem = function() {
				var wasAbleToSelect = false;
				
			 	if(selectedResultItem > 0) {
					self.setSelectedResultItem(selectedResultItem - 1);
					wasAbleToSelect = true;
				}
				
				return wasAbleToSelect;
			};
			
			
			/**
			 * Handles KeyEvents for the keyUp-Event.<br/>
			 * Search requests are sent here.
			 *
			 * @param event
			 * @access private
			 * @see SearchBoxController#handleKeyDown for UI control
			 */
			function handleKeyUp(event) {
				var keycode = event.which;
				var term = $(this).val();

				if(keycodeTriggersSearch(keycode)) {
					
					
					// @todo AJAX request
					// Following line has to be replaced with an ajax request
					var results = search(term);
					
					
					// Save response data:
					resultItems = results;
					totalResultItems = results.length;
					self.setSelectedResultItem(-1);
					
					// Show or hide Result-Container
					if(totalResultItems > 0) resultContainer.show();
					else resultContainer.hide();
					
					// Prepare result items:
					var resultList = $('<ol/>');
					for(var i = 0, l = totalResultItems; i < l; i++) {
						var text = results[i].text;
						var url = results[i].url;
						
						text = '<span class="typed">'
							   + text.substring(0,term.length)
							   + '</span>'
							   + text.substring(term.length);
						
						resultList.append(createResultItem(text,url));
					}
					resultContainer.empty();
					resultContainer.append(resultList);
				}
			};
			
			/**
			 * Handles KeyEvents for the keyDown-Event.<br/>
			 * If the user wants to select a specific result item, this
			 * action is handled here.
			 *
			 * @param event
			 * @see SearchBoxController#handleKeyUp for search requests
			 * @access private
			 */
			function handleKeyDown(event) {
				var keycode = event.which;

				if(!keycodeTriggersSearch(keycode)) {
					var preventDefault = false;

					switch(keycode) {
						case 9 : // Tab
							hideResultList();
							break;
							
						case 40 : // Down
							preventDefault = true;
							self.selectNextResultItem();
							break;
						case 38 : // Up
							preventDefault = true;
							self.selectPreviousResultItem();
							break;
						case 13 : // Enter
							// If an item is selected, open that item;
							// Otherwise, trigger search for the entered term.
							if(selectedResultItem > -1) {
								
								
								// @todo Open selected item
								console.log('Open selected result item!');
								window.href = resultItems[selectedResultItem].url;
								
								
							} else {
								
								
								// @todo Trigger search here
								console.log('Trigger search here!')
								
								
							}
							break;
						case 27 : // Escape
							preventDefault = true;
							resultContainer.hide();
							self.setSelectedResultItem(-1);
							break;
							
					}
					
					if(preventDefault) event.preventDefault();
				}
			};
			
			/**
			 * Eventhandler for the <body>'s-Clickevent.<br/>
			 * Hides the resultlist (of possible).
			 *
			 * @see SearchBoxController#hideResultList
			 * @access private
			 */
			function handleBodyClick(event) {
				if(resultContainer.is(':visible')) {
					hideResultList();
				}
			}
			
			/**
			 * Resets the selected Resultitem and hides the resultlist itselfs.
			 *
			 * @access private
			 */
			function hideResultList() {
				self.setSelectedResultItem(-1);
				resultContainer.hide();
			}
			
			/**
			 * Ensures that keys like CTRL or SHIFT don't trigger a search request.
			 *
			 * @param keycode
			 * @returns true/false
			 * @access private
			 */
			function keycodeTriggersSearch(keycode) {
				return (keycode >= 48
						|| keycode == 46
						|| keycode == 8
						|| keycode == 32
						|| keycode == 0);
			}
			
			/**
			 * Creates a list item for a searchresult with a specific text and url.<br/>
			 * There is a hover-eventbinding added by default which will selects the
			 * hovered result item.
			 *
			 * @param text Items text
			 * @param url Items url
			 * @returns DOM-Objekt
			 * @see SearchBoxController#handleKeyUp
			 * @access private
			 */
			function createResultItem(text, url) {
				var item = $('<li class="result-item"><a href="'+url+'">'+text+'</a></li>');
				item.hover(function() {
					self.setSelectedResultItem($(this).index());
				});
				
				// Ensures that the a-Element reacts as expected when clicked:
				item.parent().click(function(event) { event.stopPropagation(); })
				
				return item;
			}
			
			return self;
		}());  // end SearchBoxController
	
	
		SearchBoxController.initWithSearchBox($('#header-searchbox'));
		
		
		
		/**
		 * Simulates an AJAX-Searchrequest and returns matching resultitems.
		 * It's caseinsensitive.
		 *
		 * @param term Term
		 * @returns Array with matching items
		 */
		function search(term) {
			var objectsToSearchIn = [
				'Aargau, Kanton und Weinregion / Schweiz'
				,'Abaca'
				,'Abadesa' 	 
				,'Abbaukrankheit' 	 
				,'Abbeeren' 	 
				,'Abbondosa'
				,'Abbuoto'
				,'ABC Trinker'
				,'Abfindungsbrennerei'
				,'Abfüllen' 	 
				,'Abfüllschock' 	 
				,'Abfüllung und Reife (Wein)'
				,'Abgang' 	 
				,'abgebaut' 	 
				,'abgerundet' 	 
				,'abkühlen' 	 
				,'Ablagerung' 	 
				,'Ableger'	 
				,'aboccato'
				,'Biowein' 	 
				,'Birk, Heinrich (1898-1973)' 	 
				,'Birne - Geschmacksvielfalt beim Wein' 	 
				,'Birstaler Muskat'
				,'Bischoff, Oskar (1912-1985)' 	 
				,'Bissig (Wein)' 	 
				,'Bitartrat-Kristalle' 	 
				,'Bitter'
				,'Bittermandel' 	 
				,'Biturica' 	 
				,'Bivongi' 	 
				,'Black Eagle'
			];
			var results = Array();
			term = term.trim();
			
			if(term != '') {
				term = term.toUpperCase();
				
				for(var i = 0, l = objectsToSearchIn.length; i < l; i++) {
					var toMatch = objectsToSearchIn[i].toUpperCase();
					var result = {
						text : objectsToSearchIn[i]
						,url : '#'+i
					};
					
					if(term.length <= toMatch.length) {
						if(toMatch.substring(0,term.length) == term) {
							results.push(result);
						}
					}				
				}
			}
			
			return results;
		}
		
	</script>

	
</body>
</html>